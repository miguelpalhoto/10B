:PROPERTIES:
:GPTEL_MODEL: gpt-4o
:GPTEL_BACKEND: ChatGPT
:GPTEL_SYSTEM: You are a large language model living in Emacs and a helpful assistant. Respond concisely.
:GPTEL_BOUNDS: ((944 . 2328) (2343 . 2358) (2370 . 3598) (3615 . 3628) (3677 . 4523))
:END:
#+title: Apoio ao beancount

Tenho um ficheiro beancount com o seguinte código:
option "operating_currency" "EUR"
option "operating_currency" "GEL"

2025/02/11 * "Compra de mercadoria"
  Passivo:22Fornecedores:221FornecedoresCC                         10 GEL
  Ativo:32Mercadorias:321MercadoriasEmArmazém


 Dá este erro:
Compilation started at Wed Feb 12 17:06:05

bean-check azul.beancount
/home/ideaspot/gitHub/10B/azul.beancount:37: Invalid currency GEL for account 'Passivo:22Fornecedores:221FornecedoresCC'

   2025-02-11 * "Compra de mercadoria"
     Passivo:22Fornecedores:221FornecedoresCC      10 GEL
     Ativo:32Mercadorias:321MercadoriasEmArmazém  -10 GEL
  
Como resolvo:

O erro que você está enfrentando indica que o Beancount não está reconhecendo a moeda "GEL" no contexto do seu arquivo de transações. Como você mencionou duas vezes a opção =operating_currency=, somente a última é considerada. No seu caso, isso faz com que "EUR" seja efetivamente ignorado. Para resolver o problema, siga os passos abaixo:

1. Certifique-se de deixar apenas uma opção =operating_currency=. Se "EUR" é a moeda principal, remova a linha com "GEL":

   #+begin_src beancount
   option "operating_currency" "EUR"
   #+end_src

2. Se você deseja que ambas as moedas sejam usadas, adicione uma declaração de moeda para definir "GEL" como uma moeda permitida:

   #+begin_src beancount
   option "operating_currency" "EUR"
   commodity "GEL"
   #+end_src

3. Cada transação precisa ser balanceada. Portanto, se você tem uma entrada de 10 GEL em Passivo, a saída correspondente em Ativo deve ter o mesmo valor mas como uma despesa, ou uma conversão de moeda se for necessário:

   #+begin_src beancount
   2025/02/11 * "Compra de mercadoria"
     Passivo:22Fornecedores:221FornecedoresCC      10 GEL
     Ativo:32Mercadorias:321MercadoriasEmArmazém  -10 GEL
   #+end_src

4. Se você precisa converter valores para EUR, inclua a taxa de câmbio na transação.

Essas etapas devem ajudar a resolver o problema de reconhecimento da moeda "GEL" e a manter a contabilidade em ordem.

*** A opção =commodity "GEL"= dá erro!

Peço desculpa pelo equívoco anterior. Vamos abordar a inclusão da moeda "GEL" sem cometer erros.

No Beancount, para incluir múltiplas moedas (como "EUR" e "GEL"), é essencial apenas especificar moedas adicionais usando a declaração =commodity=. Se ainda houver problemas, veja como configurar corretamente:

1. Certifique-se de ter apenas uma declaração para a moeda operacional principal.

   #+begin_src beancount
   option "operating_currency" "EUR"
   #+end_src

2. Adicione uma linha para declarar a moeda "GEL" explicitamente como permitida no seu ficheiro.

   #+begin_src beancount
   commodity GEL
   #+end_src

3. Confirme se todas as transações estão equilibradas. No seu exemplo, elas parecem corretas em termos objetivos (os valores de =Passivo= e =Ativo= se anulam), mas precisa garantir que o Beancount saiba que ambas as moedas estão sendo usadas:

   #+begin_src beancount
   2025/02/11 * "Compra de mercadoria"
     Passivo:22Fornecedores:221FornecedoresCC      10 GEL
     Ativo:32Mercadorias:321MercadoriasEmArmazém  -10 GEL
   #+end_src

Certifique-se de que o ajuste foi feito, salvando o arquivo após as alterações. Execute novamente a verificação com o Beancount para confirmar que o erro foi resolvido.

*** O comando =commodity GEL= dá o erro: syntax error, unexpected COMMODITY

Peço desculpa pela confusão anterior. Vamos resolver o problema corretamente:

1. Certifique-se de que a declaração da moeda seja corretamente formatada. As declarações de "commodity" devem ser feitas no início do arquivo Beancount, antes das transações. A declaração para tornar a moeda GEL válida deve ser:

   = 
   commodity "GEL"
   #+end_src

2. Tenha certeza de que não há erros de sintaxe, como caracteres faltando ou incorretos. A declaração deve estar separada de outras, como transações ou opções.

3. Verifique se há algo no restante do arquivo que possa estar causanso conflitos (ex: linhas mal formatadas antes da declaração de "commodity").

Se a configuração ainda não funcionar, revise o arquivo para garantir que toda a sintaxe esteja correta e organizada. Cada componente no Beancount depende da correta formatação e sequência.

*** 
